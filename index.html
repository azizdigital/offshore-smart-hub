<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#3b82f6">
    <meta name="description" content="Offshore Smart Hub - Complete operations management system with calculators, safety reports, and MOB/DEMOB access">
    
    <!-- Apple iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Offshore Hub">
    <link rel="apple-touch-icon" href="./icons/icon-180.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="./icons/icon-192.png">
    
    <!-- Stylesheet -->
    <link rel="stylesheet" href="./styles.css">
    
    <title>üõ°Ô∏è Offshore Smart Hub</title>
</head>
<body>
    <!-- Install PWA Prompt -->
    <div id="installPrompt" class="install-prompt hidden">
        <div class="icon">üì±</div>
        <div class="content">
            <h4>Install Offshore Smart Hub</h4>
            <p>Add to your home screen for offline access</p>
        </div>
        <button class="btn btn-primary" id="installButton">Install</button>
        <button class="btn btn-secondary" id="dismissButton">‚úï</button>
    </div>

    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-container">
            <button class="nav-button" onclick="showView('home')" id="nav-home">üè† Home</button>
            <button class="nav-button" onclick="showView('mobilization')" id="nav-mobilization">üé´ Mobilization</button>
            <button class="nav-button" onclick="showView('calculator')" id="nav-calculator">üßÆ Calculators</button>
            <button class="nav-button" onclick="showView('report')" id="nav-report">üìÑ Reports</button>
        </div>
    </nav>

    <div class="container">
        <!-- Home View -->
        <div id="view-home" class="view-section">
            <div class="header">
                <h1>üõ°Ô∏è Offshore Smart Hub</h1>
                <p>Complete offshore operations management system</p>
            </div>
            <div class="menu-grid">
                <div class="menu-card" onclick="showView('mobilization')">
                    <div class="card-icon">üé´</div>
                    <h3>One-Tap Mobilization</h3>
                    <p>Quick access to MOB/DEMOB systems</p>
                </div>
                <div class="menu-card" onclick="showView('calculator')">
                    <div class="card-icon">üßÆ</div>
                    <h3>Engineering Calculators</h3>
                    <p>12 offshore engineering calculators</p>
                </div>
                <div class="menu-card" onclick="showView('report')">
                    <div class="card-icon">üìÑ</div>
                    <h3>Safety Reports</h3>
                    <p>Generate and refine professional reports</p>
                </div>
            </div>
        </div>

        <!-- One-Tap Mobilization View -->
        <div id="view-mobilization" class="view-section hidden">
            <div class="header">
                <h1>üé´ One-Tap Mobilization</h1>
                <p>Quick access to PETRONAS MOB/DEMOB systems</p>
            </div>

            <div class="access-grid">
                <div class="access-card health" onclick="openLink('https://osis.petronas.com/health-declaration/form')">
                    <div class="card-icon">üè•</div>
                    <h3>Health Declaration</h3>
                    <p>Complete before mobilization</p>
                    <div class="card-badge">Before MOB</div>
                </div>

                <div class="access-card mob" onclick="openLink('https://qrscan.up.petronas.com/#/home?locationId=ep-ktsb-e-1&locationName=KUALA%20TERENGGANU%20SUPPORT%20BASE%20-%20ENTRANCE')">
                    <div class="card-icon">‚úÖ</div>
                    <h3>Check-In (MOB)</h3>
                    <p>KTSB Entrance scan</p>
                    <div class="card-badge">Mobilization</div>
                </div>

                <div class="access-card demob" onclick="openLink('https://qrscan.up.petronas.com/#/home?locationId=ep-ktsb-e-2&locationName=KUALA%20TERENGGANU%20SUPPORT%20BASE%20-%20EXIT')">
                    <div class="card-icon">üö™</div>
                    <h3>Check-Out (DEMOB)</h3>
                    <p>KTSB Exit scan</p>
                    <div class="card-badge">Demobilization</div>
                </div>
            </div>

            <div class="card workflow-card">
                <h4>üìã Quick Workflow</h4>
                <div class="workflow-steps">
                    <div class="workflow-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <div class="step-title">Health Declaration</div>
                            <div class="step-desc">Complete form 24 hours before mobilization</div>
                        </div>
                    </div>
                    <div class="workflow-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <div class="step-title">Check-In at KTSB</div>
                            <div class="step-desc">Scan QR at entrance before boarding</div>
                        </div>
                    </div>
                    <div class="workflow-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <div class="step-title">Check-Out after Return</div>
                            <div class="step-desc">Scan QR at exit upon demobilization</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calculator View -->
        <div id="view-calculator" class="view-section hidden">
            <div class="header">
                <h1>üßÆ Engineering Calculators</h1>
                <p>Complete collection of 12 offshore calculators</p>
            </div>

            <div class="calc-container">
                <!-- Volume Conversion -->
                <div class="card">
                    <h3>üìä Volume Conversion</h3>
                    <div class="form-group">
                        <label>Input Value</label>
                        <input type="number" id="volumeInput" class="form-control" placeholder="Value" step="0.001">
                    </div>
                    <div class="form-group">
                        <label>Conversion Type</label>
                        <select id="volumeType" class="form-control">
                            <option value="kld_kbd">KLD to KBD</option>
                            <option value="kbd_kld">KBD to KLD</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Shrinkage Factor</label>
                        <input type="number" id="shrinkageFactor" class="form-control" placeholder="0.881" step="0.001" value="0.881">
                    </div>
                    <button class="btn btn-primary" onclick="convertVolume()">üîÑ Convert</button>
                    <div id="volumeResult" class="calc-result" style="display:none"></div>
                </div>

                <!-- Universal Unit Converter -->
                <div class="card">
                    <h3>üìè Universal Unit Converter</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>From</label>
                            <select id="fromUnit" class="form-control">
                                <optgroup label="Pressure">
                                    <option value="kpa">KpA</option>
                                    <option value="psi">PSI</option>
                                    <option value="bar">Bar</option>
                                </optgroup>
                                <optgroup label="Temperature">
                                    <option value="celsius">¬∞C</option>
                                    <option value="fahrenheit">¬∞F</option>
                                </optgroup>
                                <optgroup label="Length">
                                    <option value="inches">Inches</option>
                                    <option value="cm">cm</option>
                                    <option value="feet">Feet</option>
                                    <option value="meters">Meters</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>To</label>
                            <select id="toUnit" class="form-control">
                                <optgroup label="Pressure">
                                    <option value="kpa">KpA</option>
                                    <option value="psi">PSI</option>
                                    <option value="bar">Bar</option>
                                </optgroup>
                                <optgroup label="Temperature">
                                    <option value="celsius">¬∞C</option>
                                    <option value="fahrenheit">¬∞F</option>
                                </optgroup>
                                <optgroup label="Length">
                                    <option value="inches">Inches</option>
                                    <option value="cm">cm</option>
                                    <option value="feet">Feet</option>
                                    <option value="meters">Meters</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Input Value</label>
                        <input type="number" id="universalValue" class="form-control" placeholder="Enter value">
                    </div>
                    <button class="btn btn-primary" onclick="convertUniversal()">‚ÜîÔ∏è Convert</button>
                    <div id="universalResult" class="calc-result" style="display:none"></div>
                </div>

                <!-- Gas Conversion -->
                <div class="card">
                    <h3>‚õΩ Gas Flow Conversion</h3>
                    <div class="form-group">
                        <label>Input Value</label>
                        <input type="number" id="gasInput" class="form-control" placeholder="Value" step="0.001">
                    </div>
                    <div class="form-group">
                        <label>Conversion Type</label>
                        <select id="gasType" class="form-control">
                            <option value="km3_mmscf">km¬≥/d to mmscf/d</option>
                            <option value="mmscf_km3">mmscf/d to km¬≥/d</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="convertGas()">üîÑ Convert</button>
                    <div id="gasResult" class="calc-result" style="display:none"></div>
                </div>

                <!-- Crude Oil Drop Rate -->
                <div class="card">
                    <h3>üíß Crude Oil Leak (Drop Rate)</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Drops per Minute</label>
                            <input type="number" id="dropRate" class="form-control" placeholder="60" step="1">
                        </div>
                        <div class="form-group">
                            <label>Duration (minutes)</label>
                            <input type="number" id="dropDuration" class="form-control" placeholder="120" step="1">
                        </div>
                        <div class="form-group">
                            <label>Drop Size</label>
                            <select id="dropSize" class="form-control">
                                <option value="0.05">Small (~0.05ml)</option>
                                <option value="0.1">Medium (~0.1ml)</option>
                                <option value="0.2">Large (~0.2ml)</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="calculateDropLeak()">üìä Calculate</button>
                    <div id="dropLeakResult" class="calc-result" style="display:none"></div>
                </div>

                <!-- Natural Gas Leak -->
                <div class="card">
                    <h3>‚õΩ Natural Gas Leak</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Diameter (mm)</label>
                            <input type="number" id="gasHoleDiameter" class="form-control" placeholder="5" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>Pressure (bar)</label>
                            <input type="number" id="gasPressure" class="form-control" placeholder="50" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>Duration (minutes)</label>
                            <input type="number" id="gasDuration" class="form-control" placeholder="10" step="1">
                        </div>
                        <div class="form-group">
                            <label>Temperature (¬∞C)</label>
                            <input type="number" id="gasTemperature" class="form-control" placeholder="35" step="1">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="calculateGasLeak()">üìä Calculate</button>
                    <div id="gasLeakResult" class="calc-result" style="display:none"></div>
                </div>

                <!-- Crude Oil Pin Hole Leak -->
                <div class="card">
                    <h3>üõ¢Ô∏è Crude Oil Leak (Pin Hole)</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Diameter (mm)</label>
                            <input type="number" id="oilHoleDiameter" class="form-control" placeholder="2" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>Pressure (bar)</label>
                            <input type="number" id="oilPressure" class="form-control" placeholder="56" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>Duration (minutes)</label>
                            <input type="number" id="oilDuration" class="form-control" placeholder="25" step="1">
                        </div>
                        <div class="form-group">
                            <label>Density (kg/m¬≥)</label>
                            <input type="number" id="oilDensity" class="form-control" placeholder="700" step="1">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="calculateOilLeak()">üìä Calculate</button>
                    <div id="oilLeakResult" class="calc-result" style="display:none"></div>
                </div>

                <!-- Production Volume Loss -->
                <div class="card">
                    <h3>üìâ Production Volume Loss</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Shutdown Hours</label>
                            <input type="number" id="shutdownHours" class="form-control" placeholder="2" step="1">
                        </div>
                        <div class="form-group">
                            <label>Shutdown Minutes</label>
                            <input type="number" id="shutdownMinutes" class="form-control" placeholder="30" step="1">
                        </div>
                        <div class="form-group">
                            <label>Normal Production (KBD)</label>
                            <input type="number" id="normalProduction" class="form-control" placeholder="750" step="0.1">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="calculateProductionLoss()">üìä Calculate</button>
                    <div id="productionLossResult" class="calc-result" style="display:none"></div>
                </div>

                <!-- Chemical Injection Rate -->
                <div class="card">
                    <h3>üß™ Chemical Injection Rate</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Injection Rate (L/hr)</label>
                            <input type="number" id="injectionRate" class="form-control" placeholder="2.5" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>Concentration (PPM)</label>
                            <input type="number" id="chemPPM" class="form-control" placeholder="100" step="1">
                        </div>
                        <div class="form-group">
                            <label>Drum Size</label>
                            <select id="drumSize" class="form-control">
                                <option value="159">159L Drum</option>
                                <option value="210">210L Drum</option>
                                <option value="259">259L Drum</option>
                                <option value="custom">Custom Size</option>
                            </select>
                        </div>
                        <div class="form-group" id="customDrumGroup" style="display:none">
                            <label>Custom Size (L)</label>
                            <input type="number" id="customDrumSize" class="form-control" placeholder="200">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="calculateChemical()">üìä Calculate</button>
                    <div id="chemicalResult" class="calc-result" style="display:none"></div>
                </div>

                <!-- Drop Object Calculator -->
                <div class="card">
                    <h3>‚¨áÔ∏è Drop Object Calculator</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Object Weight (kg)</label>
                            <input type="number" id="objectWeight" class="form-control" placeholder="5" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>Drop Height (m)</label>
                            <input type="number" id="dropHeight" class="form-control" placeholder="10" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>PPE Level</label>
                            <select id="ppeLevel" class="form-control">
                                <option value="1">Basic (Hard Hat)</option>
                                <option value="0.7">Enhanced (+ Safety Vest)</option>
                                <option value="0.5">Full PPE</option>
                                <option value="custom">Custom Factor</option>
                            </select>
                        </div>
                        <div class="form-group" id="customPPEGroup" style="display:none">
                            <label>Custom PPE Factor</label>
                            <input type="number" id="customPPEFactor" class="form-control" placeholder="0.3" step="0.1">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="calculateDropObject()">üìä Calculate</button>
                    <div id="dropObjectResult" class="calc-result" style="display:none"></div>
                </div>

                <!-- Crane Lifting Calculator -->
                <div class="card">
                    <h3>üèóÔ∏è Crane Lifting Calculator</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Load Weight (tonnes)</label>
                            <input type="number" id="loadWeight" class="form-control" placeholder="15" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>Boom Length (m)</label>
                            <input type="number" id="boomLength" class="form-control" placeholder="25" step="0.5">
                        </div>
                        <div class="form-group">
                            <label>Crane Type</label>
                            <select id="craneType" class="form-control">
                                <option value="40">40T Crane</option>
                                <option value="9">9T Crane</option>
                                <option value="13">13T Crane</option>
                                <option value="custom">Custom Capacity</option>
                            </select>
                        </div>
                        <div class="form-group" id="customCraneGroup" style="display:none">
                            <label>Custom Capacity (T)</label>
                            <input type="number" id="customCraneCapacity" class="form-control" placeholder="50">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="calculateCrane()">üìä Calculate</button>
                    <div id="craneResult" class="calc-result" style="display:none"></div>
                </div>

                <!-- Fuel Consumption -->
                <div class="card">
                    <h3>‚õΩ Fuel Consumption</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Turbine Type</label>
                            <select id="turbineType" class="form-control">
                                <option value="saturn20">Saturn 20 (1.2MW)</option>
                                <option value="centaur40">Centaur 40 (4.0MW)</option>
                                <option value="centaur50">Centaur 50 (5.0MW)</option>
                                <option value="taurus60">Taurus 60 (4.8MW)</option>
                                <option value="custom">Custom Turbine</option>
                            </select>
                        </div>
                        <div class="form-group" id="customTurbineGroup" style="display:none">
                            <label>Custom Fuel Rate (L/hr)</label>
                            <input type="number" id="customTurbineRate" class="form-control" placeholder="2000" step="10">
                        </div>
                        <div class="form-group">
                            <label>Load Percentage (%)</label>
                            <input type="number" id="turbineLoad" class="form-control" placeholder="75" step="1" min="0" max="100">
                        </div>
                        <div class="form-group">
                            <label>Operating Hours</label>
                            <input type="number" id="operatingHours" class="form-control" placeholder="24" step="0.1">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="calculateFuel()">üìä Calculate</button>
                    <div id="fuelResult" class="calc-result" style="display:none"></div>
                </div>

                <!-- Weather Impact -->
                <div class="card">
                    <h3>üåä Weather Impact Assessment</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Wind Speed (knots)</label>
                            <input type="number" id="windSpeed" class="form-control" placeholder="25" step="1">
                        </div>
                        <div class="form-group">
                            <label>Wave Height (m)</label>
                            <input type="number" id="waveHeight" class="form-control" placeholder="2.5" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>Operation Type</label>
                            <select id="operationType" class="form-control">
                                <option value="heli">Helicopter Ops</option>
                                <option value="boat">Boat Transfer</option>
                                <option value="crane">Crane Operations</option>
                                <option value="diving">Diving Operations</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="calculateWeather()">üìä Calculate</button>
                    <div id="weatherResult" class="calc-result" style="display:none"></div>
                </div>
            </div>
        </div>

        <!-- Safety Report View -->
        <div id="view-report" class="view-section hidden">
            <div class="header">
                <h1>üìÑ Safety Report Generator</h1>
                <p>Generate professional safety reports with AI refinement</p>
            </div>

            <div class="card">
                <h3>üìù Report Details</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Incident Type</label>
                        <select id="incidentType" class="form-control">
                            <option value="Near Miss">Near Miss</option>
                            <option value="First Aid">First Aid</option>
                            <option value="Medical Treatment">Medical Treatment</option>
                            <option value="Lost Time Injury">Lost Time Injury</option>
                            <option value="Equipment Failure">Equipment Failure</option>
                            <option value="Environmental">Environmental</option>
                            <option value="Safety Observation">Safety Observation</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Platform/Location</label>
                        <input type="text" id="reportLocation" class="form-control" placeholder="e.g., Irong Barat A" value="Irong Barat A">
                    </div>
                    <div class="form-group">
                        <label>Reporter Name</label>
                        <input type="text" id="reporterName" class="form-control" placeholder="Your name">
                    </div>
                    <div class="form-group">
                        <label>Date & Time</label>
                        <input type="datetime-local" id="incidentDateTime" class="form-control">
                    </div>
                </div>

                <div class="form-group">
                    <label>Incident Description</label>
                    <div class="textarea-wrapper">
                        <textarea id="incidentDescription" class="form-control" placeholder="Describe what happened in detail..."></textarea>
                        <button class="handwriting-toggle" onclick="toggleHandwriting('incidentDescription')" title="Toggle handwriting mode">‚úçÔ∏è</button>
                    </div>
                    <div id="canvas-incidentDescription" class="handwriting-canvas hidden"></div>
                </div>

                <div class="form-group">
                    <label>Immediate Actions Taken</label>
                    <div class="textarea-wrapper">
                        <textarea id="immediateActions" class="form-control" placeholder="What actions were taken immediately..."></textarea>
                        <button class="handwriting-toggle" onclick="toggleHandwriting('immediateActions')" title="Toggle handwriting mode">‚úçÔ∏è</button>
                    </div>
                    <div id="canvas-immediateActions" class="handwriting-canvas hidden"></div>
                </div>

                <div class="form-group">
                    <label>Root Cause Analysis</label>
                    <div class="textarea-wrapper">
                        <textarea id="rootCause" class="form-control" placeholder="Identified root causes..."></textarea>
                        <button class="handwriting-toggle" onclick="toggleHandwriting('rootCause')" title="Toggle handwriting mode">‚úçÔ∏è</button>
                    </div>
                    <div id="canvas-rootCause" class="handwriting-canvas hidden"></div>
                </div>

                <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:16px">
                    <button class="btn btn-primary" onclick="generateReport()">üìù Generate Report</button>
                    <button class="btn btn-secondary" onclick="clearReport()">üîÑ Clear</button>
                </div>
            </div>

            <div id="reportOutput" class="hidden">
                <div class="card">
                    <h3>üìÑ Generated Report</h3>
                    <div class="report-box">
                        <div id="generatedReport" class="report-text"></div>
                    </div>
                    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:12px">
                        <button class="btn btn-success" onclick="downloadReport()">üíæ Download Report</button>
                        <button class="btn btn-warning" onclick="showRefinePrompt()">‚ú® Refine with AI</button>
                        <button class="btn btn-info" onclick="copyReport()">üìã Copy Report</button>
                    </div>
                </div>

                <div id="refineSection" class="hidden">
                    <div class="card">
                        <h3>‚ú® AI Refinement Prompt</h3>
                        <div class="prompt-box">
                            <div class="prompt-text" id="aiPrompt"></div>
                            <button class="btn btn-primary" onclick="copyPromptAndReport()">üìã Copy Prompt + Report</button>
                        </div>
                        <div class="alert alert-info">
                            <strong>üí° Instructions:</strong> Click the button above to copy both the prompt and your report. Then paste it into ChatGPT, Claude, or any AI model to get a refined, professional version suitable for WhatsApp or email to your boss.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
    <script src="./app.js"></script>
    <script src="./handwriting.js"></script>
    <script src="./pwa.js"></script>
</body>
</html>
