<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- PWA Meta Tags -->
    <meta name="application-name" content="Offshore Smart Hub">
    <meta name="description" content="Complete offshore operations companion for PETRONAS installations">
    <meta name="theme-color" content="#3b82f6">
    
    <!-- Apple iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Offshore Smart Hub">
    <link rel="apple-touch-icon" href="./icons/icon-192.png">
    
    <!-- Manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="192x192" href="./icons/icon-192.png">
    
    <title>Offshore Smart Hub</title>
    
    <!-- Styles -->
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <!-- Navigation -->
    <div class="nav-bar">
        <div class="nav-header">
            <h1>üè¢ OFFSHORE SMART HUB</h1>
        </div>
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showView('home')">üè† Home</button>
            <button class="nav-tab" onclick="showView('mobilization')">‚úàÔ∏è MOB/DEMOB</button>
            <button class="nav-tab" onclick="showView('calculator')">üîß Calculators</button>
            <button class="nav-tab" onclick="showView('report')">üìä Reports</button>
        </div>
    </div>

    <div class="container">
        <!-- HOME VIEW -->
        <div id="home" class="view active">
            <div class="card welcome-box">
                <h2>Welcome to Offshore Smart Hub</h2>
                <p>Your complete offshore operations companion</p>
                
                <div class="quick-access">
                    <div class="quick-card" onclick="showView('mobilization')">
                        <h3>üìã MOB/DEMOB System</h3>
                        <p>Health Declaration & Check-In/Out</p>
                    </div>
                    
                    <div class="quick-card" onclick="showView('calculator')">
                        <h3>üîß Engineering Calculators</h3>
                        <p>12 calculation tools for offshore operations</p>
                    </div>
                    
                    <div class="quick-card" onclick="showView('report')">
                        <h3>üìä Safety Reports</h3>
                        <p>Quick reporting system with WhatsApp format</p>
                    </div>
                </div>
                
                <div class="platform-info">
                    <h3>Platform Coverage</h3>
                    <ul>
                        <li>‚Ä¢ Irong Barat A (IbA)</li>
                        <li>‚Ä¢ Irong Barat B (IbB)</li>
                        <li>‚Ä¢ Irong Barat C (IbC)</li>
                    </ul>
                </div>
            </div>
            
            <div class="footer">
                Developed for PETRONAS Offshore Operations<br>
                Offshore Installation Manager Tool
            </div>
        </div>

        <!-- MOB/DEMOB VIEW -->
        <div id="mobilization" class="view">
            <div class="card">
                <div class="card-title">üìã Health Declaration Form (MOB)</div>
                <div class="card-description">Complete your health declaration before mobilization to platform</div>
                <a href="https://osis.petronas.com/health-declaration/form" target="_blank" class="btn btn-primary">üìù Open Health Declaration Form</a>
            </div>
            
            <div class="card border-green">
                <div class="card-title">‚úàÔ∏è MyPET Check-In (MOB)</div>
                <div class="card-subtitle">KTSB Entrance - Mobilization</div>
                <ol>
                    <li>Complete health declaration first</li>
                    <li>Arrive at KTSB entrance</li>
                    <li>Click button below to check-in</li>
                </ol>
                <a href="https://qrscan.up.petronas.com/#/home?locationId=ep-ktsb-e-1&locationName=KUALA%20TERENGGANU%20SUPPORT%20BASE%20-%20ENTRANCE" target="_blank" class="btn btn-green">‚úÖ Check-In at KTSB Entrance</a>
            </div>
            
            <div class="card border-orange">
                <div class="card-title">üöÅ MyPET Check-Out (DEMOB)</div>
                <div class="card-subtitle">KTSB Exit - Demobilization</div>
                <ol>
                    <li>Complete offshore handover</li>
                    <li>Arrive at KTSB exit gate</li>
                    <li>Click button below to check-out</li>
                </ol>
                <a href="https://qrscan.up.petronas.com/#/home?locationId=ep-ktsb-e-2&locationName=KUALA%20TERENGGANU%20SUPPORT%20BASE%20-%20EXIT" target="_blank" class="btn btn-orange">üëã Check-Out at KTSB Exit</a>
            </div>
        </div>

        <!-- CALCULATOR VIEW -->
        <div id="calculator" class="view">
            <div class="grid grid-3">
                <!-- Calculator 1: Volume Conversion -->
                <div class="card">
                    <div class="card-title">1. Volume Conversion</div>
                    <div class="form-group">
                        <label class="form-label">Value</label>
                        <input type="number" id="volumeInput" class="form-input" step="any">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Conversion Type</label>
                        <select id="volumeType" class="form-select">
                            <option value="kld_kbd">KLD ‚Üí KBD</option>
                            <option value="kbd_kld">KBD ‚Üí KLD</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Shrinkage Factor</label>
                        <input type="number" id="shrinkageFactor" class="form-input" value="0.881" step="0.001">
                    </div>
                    <button onclick="convertVolume()" class="btn btn-primary">Calculate</button>
                    <div id="volumeResult" class="result-box result-primary"></div>
                </div>

                <!-- Calculator 2: Universal Unit Converter -->
                <div class="card">
                    <div class="card-title">2. Universal Unit Converter</div>
                    <div class="form-group">
                        <label class="form-label">From Unit</label>
                        <select id="fromUnit" class="form-select">
                            <option value="kpa">kPa</option>
                            <option value="psi">PSI</option>
                            <option value="bar">Bar</option>
                            <option value="celsius">¬∞C</option>
                            <option value="fahrenheit">¬∞F</option>
                            <option value="inches">Inches</option>
                            <option value="cm">cm</option>
                            <option value="feet">Feet</option>
                            <option value="meters">Meters</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">To Unit</label>
                        <select id="toUnit" class="form-select">
                            <option value="psi">PSI</option>
                            <option value="kpa">kPa</option>
                            <option value="bar">Bar</option>
                            <option value="celsius">¬∞C</option>
                            <option value="fahrenheit">¬∞F</option>
                            <option value="inches">Inches</option>
                            <option value="cm">cm</option>
                            <option value="feet">Feet</option>
                            <option value="meters">Meters</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Value</label>
                        <input type="number" id="universalValue" class="form-input" step="any">
                    </div>
                    <button onclick="convertUniversal()" class="btn btn-primary">Convert</button>
                    <div id="universalResult" class="result-box result-primary"></div>
                </div>

                <!-- Calculator 3: Gas Flow Conversion -->
                <div class="card">
                    <div class="card-title">3. Gas Flow Conversion</div>
                    <div class="form-group">
                        <label class="form-label">Value</label>
                        <input type="number" id="gasInput" class="form-input" step="any">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Conversion Type</label>
                        <select id="gasType" class="form-select">
                            <option value="km3_mmscf">km¬≥/d ‚Üí mmscf/d</option>
                            <option value="mmscf_km3">mmscf/d ‚Üí km¬≥/d</option>
                        </select>
                    </div>
                    <button onclick="convertGas()" class="btn btn-primary">Convert</button>
                    <div id="gasResult" class="result-box result-primary"></div>
                </div>

                <!-- Calculator 4: Crude Oil Leak (Drop Rate) -->
                <div class="card">
                    <div class="card-title">4. Crude Oil Leak (Drop Rate)</div>
                    <div class="form-group">
                        <label class="form-label">Drops per Minute</label>
                        <input type="number" id="dropRate" class="form-input" step="any">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Duration (minutes)</label>
                        <input type="number" id="dropDuration" class="form-input" step="any">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Drop Size</label>
                        <select id="dropSize" class="form-select">
                            <option value="0.05">Small (~0.05ml)</option>
                            <option value="0.1">Medium (~0.1ml)</option>
                            <option value="0.2">Large (~0.2ml)</option>
                        </select>
                    </div>
                    <button onclick="calculateDropLeak()" class="btn btn-primary">Calculate</button>
                    <div id="dropLeakResult" class="result-box result-primary"></div>
                </div>

                <!-- Calculator 5: Natural Gas Leak -->
                <div class="card">
                    <div class="card-title">5. Natural Gas Leak</div>
                    <div class="form-group">
                        <label class="form-label">Diameter (mm)</label>
                        <input type="number" id="gasHoleDiameter" class="form-input" step="any">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Pressure (bar)</label>
                        <input type="number" id="gasPressure" class="form-input" step="any">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Duration (min)</label>
                        <input type="number" id="gasDuration" class="form-input" step="any">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Temperature (¬∞C)</label>
                        <input type="number" id="gasTemperature" class="form-input" value="35" step="any">
                    </div>
                    <button onclick="calculateGasLeak()" class="btn btn-primary">Calculate</button>
                    <div id="gasLeakResult" class="result-box result-primary"></div>
                </div>

                <!-- Calculator 6: Crude Oil Leak (Pin Hole) -->
                <div class="card">
                    <div class="card-title">6. Crude Oil Leak (Pin Hole)</div>
                    <div class="form-group">
                        <label class="form-label">Diameter (mm)</label>
                        <input type="number" id="oilHoleDiameter" class="form-input" step="any">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Pressure (bar)</label>
                        <input type="number" id="oilPressure" class="form-input" step="any">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Duration (min)</label>
                        <input type="number" id="oilDuration" class="form-input" step="any">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Density (kg/m¬≥)</label>
                        <input type="number" id="oilDensity" class="form-input" value="700" step="any">
                    </div>
                    <button onclick="calculateOilLeak()" class="btn btn-primary">Calculate</button>
                    <div id="oilLeakResult" class="result-box result-primary"></div>
                    <div id="thresholdResult" class="result-box result-warning"></div>
                </div>

                <!-- Calculator 7: Production Volume Loss -->
                <div class="card">
                    <div class="card-title">7. Production Volume Loss</div>
                    <div class="form-group">
                        <label class="form-label">Shutdown Hours</label>
                        <input type="number" id="shutdownHours" class="form-input" step="any" value="0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Shutdown Minutes</label>
                        <input type="number" id="shutdownMinutes" class="form-input" step="any" value="0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Normal Production (KBD)</label>
                        <input type="number" id="normalProduction" class="form-input" step="any">
                    </div>
                    <button onclick="calculateProductionLoss()" class="btn btn-primary">Calculate</button>
                    <div id="productionLossResult" class="result-box result-primary"></div>
                </div>

                <!-- Calculator 8: Chemical Injection Rate -->
                <div class="card">
                    <div class="card-title">8. Chemical Injection Rate</div>
                    <div class="form-group">
                        <label class="form-label">Injection Rate (L/hr)</label>
                        <input type="number" id="injectionRate" class="form-input" step="any">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Concentration (PPM)</label>
                        <input type="number" id="chemPPM" class="form-input" step="any">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Drum Size</label>
                        <select id="drumSize" class="form-select" onchange="toggleCustomDrum()">
                            <option value="159">159L Drum</option>
                            <option value="210">210L Drum</option>
                            <option value="259">259L Drum</option>
                            <option value="custom">Custom Size</option>
                        </select>
                    </div>
                    <div class="form-group hidden" id="customDrumGroup">
                        <label class="form-label">Custom Drum Size (L)</label>
                        <input type="number" id="customDrumSize" class="form-input" step="any">
                    </div>
                    <button onclick="calculateChemical()" class="btn btn-primary">Calculate</button>
                    <div id="chemicalResult" class="result-box result-primary"></div>
                </div>

                <!-- Calculator 9: Drop Object Calculator -->
                <div class="card">
                    <div class="card-title">9. Drop Object Calculator</div>
                    <div class="form-group">
                        <label class="form-label">Object Weight (kg)</label>
                        <input type="number" id="objectWeight" class="form-input" step="any">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Drop Height (m)</label>
                        <input type="number" id="dropHeight" class="form-input" step="any">
                    </div>
                    <div class="form-group">
                        <label class="form-label">PPE Level</label>
                        <select id="ppeLevel" class="form-select" onchange="toggleCustomPPE()">
                            <option value="1">Basic (Hard Hat)</option>
                            <option value="0.7">Enhanced (+ Safety Vest)</option>
                            <option value="0.5">Full PPE</option>
                            <option value="custom">Custom Factor</option>
                        </select>
                    </div>
                    <div class="form-group hidden" id="customPPEGroup">
                        <label class="form-label">Custom PPE Factor</label>
                        <input type="number" id="customPPEFactor" class="form-input" step="0.1">
                    </div>
                    <button onclick="calculateDropObject()" class="btn btn-primary">Calculate</button>
                    <div id="dropObjectResult" class="result-box result-primary"></div>
                </div>

                <!-- Calculator 10: Crane Lifting Calculator -->
                <div class="card">
                    <div class="card-title">10. Crane Lifting Calculator</div>
                    <div class="form-group">
                        <label class="form-label">Load Weight (tonnes)</label>
                        <input type="number" id="loadWeight" class="form-input" step="any">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Boom Length (m)</label>
                        <input type="number" id="boomLength" class="form-input" step="any">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Crane Type</label>
                        <select id="craneType" class="form-select" onchange="toggleCustomCrane()">
                            <option value="40">40T (IbA - ME 450)</option>
                            <option value="9">9T (IbA - ME 400)</option>
                            <option value="13">13T (IbB - ME 290)</option>
                            <option value="13">13T (IbC - ME 290)</option>
                            <option value="custom">Custom Capacity</option>
                        </select>
                    </div>
                    <div class="form-group hidden" id="customCraneGroup">
                        <label class="form-label">Custom Capacity (tonnes)</label>
                        <input type="number" id="customCraneCapacity" class="form-input" step="any">
                    </div>
                    <button onclick="calculateCrane()" class="btn btn-primary">Calculate</button>
                    <div id="craneResult" class="result-box result-primary"></div>
                </div>

                <!-- Calculator 11: Fuel Consumption -->
                <div class="card">
                    <div class="card-title">11. Fuel Consumption</div>
                    <div class="form-group">
                        <label class="form-label">Turbine Type</label>
                        <select id="turbineType" class="form-select" onchange="toggleCustomTurbine()">
                            <option value="saturn20">Saturn 20 (1.2MW)</option>
                            <option value="centaur40">Centaur 40 (4.0MW)</option>
                            <option value="centaur50">Centaur 50 (5.0MW)</option>
                            <option value="taurus60">Taurus 60 (4.8MW)</option>
                            <option value="taurus70">Taurus 70 (7.7MW)</option>
                            <option value="mars90">Mars 90 (9.8MW)</option>
                            <option value="mars100">Mars 100 (12MW)</option>
                            <option value="titan130">Titan 130 (13.5MW)</option>
                            <option value="rb211">RB211 (Rolls-Royce)</option>
                            <option value="kongsberg">Kongsberg Engine</option>
                            <option value="custom">Custom Turbine</option>
                        </select>
                    </div>
                    <div class="form-group hidden" id="customTurbineGroup">
                        <label class="form-label">Custom Fuel Rate (L/hr)</label>
                        <input type="number" id="customTurbineRate" class="form-input" step="any">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Load Percentage (%)</label>
                        <input type="number" id="turbineLoad" class="form-input" step="any" min="0" max="100">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Operating Hours</label>
                        <input type="number" id="operatingHours" class="form-input" step="any">
                    </div>
                    <button onclick="calculateFuel()" class="btn btn-primary">Calculate</button>
                    <div id="fuelResult" class="result-box result-primary"></div>
                </div>

                <!-- Calculator 12: Weather Impact -->
                <div class="card">
                    <div class="card-title">12. Weather Impact</div>
                    <div class="form-group">
                        <label class="form-label">Wind Speed (knots)</label>
                        <input type="number" id="windSpeed" class="form-input" step="any">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Wave Height (m)</label>
                        <input type="number" id="waveHeight" class="form-input" step="any">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Operation Type</label>
                        <select id="operationType" class="form-select" onchange="toggleCustomWeather()">
                            <option value="heli">Helicopter Ops</option>
                            <option value="boat">Boat Transfer</option>
                            <option value="crane">Crane Operations</option>
                            <option value="diving">Diving Operations</option>
                            <option value="custom">Custom Operation</option>
                        </select>
                    </div>
                    <div class="form-group hidden" id="customWeatherGroup">
                        <label class="form-label">Custom Wind Limit (knots)</label>
                        <input type="number" id="customWindLimit" class="form-input" step="any">
                        <label class="form-label" style="margin-top:10px">Custom Wave Limit (m)</label>
                        <input type="number" id="customWaveLimit" class="form-input" step="any">
                    </div>
                    <button onclick="calculateWeather()" class="btn btn-primary">Calculate</button>
                    <div id="weatherResult" class="result-box result-primary"></div>
                </div>
            </div>
        </div>

        <!-- REPORT VIEW -->
        <div id="report" class="view">
            <div class="card">
                <div class="card-title">Safety Report Generator</div>
                
                <div class="form-group">
                    <label class="form-label">Report Type</label>
                    <select id="reportType" class="form-select">
                        <option value="LOPC">LOPC (Loss of Primary Containment)</option>
                        <option value="Emergency / Fire Alarm">Emergency / Fire Alarm</option>
                        <option value="Medical Case">Medical Case</option>
                        <option value="Near Miss">Near Miss</option>
                        <option value="Incident/Accident">Incident/Accident</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Platform</label>
                    <select id="reportPlatform" class="form-select">
                        <option value="Irong Barat A (IbA)">Irong Barat A (IbA)</option>
                        <option value="Irong Barat B (IbB)">Irong Barat B (IbB)</option>
                        <option value="Irong Barat C (IbC)">Irong Barat C (IbC)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Module/Area</label>
                    <input type="text" id="reportModule" class="form-input" placeholder="e.g., Living Quarter, Process Area">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Incident Title</label>
                    <input type="text" id="reportTitle" class="form-input" placeholder="Brief title of the incident">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Date</label>
                    <input type="date" id="reportDate" class="form-input">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Time</label>
                    <input type="time" id="reportTime" class="form-input">
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        Brief Description
                        <button onclick="toggleHandwriting('reportDescription')" class="handwriting-icon-btn" title="Toggle handwriting mode">‚úçÔ∏è</button>
                    </label>
                    <textarea id="reportDescription" class="form-textarea" placeholder="Describe what happened..."></textarea>
                    <div id="canvas-reportDescription" class="canvas-container hidden"></div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        Action Taken
                        <button onclick="toggleHandwriting('reportAction')" class="handwriting-icon-btn" title="Toggle handwriting mode">‚úçÔ∏è</button>
                    </label>
                    <textarea id="reportAction" class="form-textarea" placeholder="Immediate actions taken..."></textarea>
                    <div id="canvas-reportAction" class="canvas-container hidden"></div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        Way Forward
                        <button onclick="toggleHandwriting('reportForward')" class="handwriting-icon-btn" title="Toggle handwriting mode">‚úçÔ∏è</button>
                    </label>
                    <textarea id="reportForward" class="form-textarea" placeholder="Next steps and recommendations..."></textarea>
                    <div id="canvas-reportForward" class="canvas-container hidden"></div>
                </div>
                
                <button onclick="generateReport()" class="btn btn-primary">Generate Report</button>
                
                <div id="reportOutput" class="report-output hidden"></div>
                
                <div id="reportButtons" class="hidden" style="display: flex; gap: 12px; margin-top: 16px;">
                    <button onclick="copyReport()" class="btn btn-secondary" style="flex: 1;">üìã Copy Report</button>
                    <button onclick="copyReportWithPrompt()" class="btn btn-primary" style="flex: 1;">‚ú® Refine with AI</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
    <script src="./handwriting.js"></script>
    <script src="./app.js"></script>
    
    <!-- PWA Registration -->
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('Service Worker registered successfully:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
        
        // Install prompt for PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('PWA install prompt ready');
        });
    </script>
    <footer class="site-footer">
  <p>¬© 2025 Aziz Mohamad</p>
  <p>Enterprise Solutions Division</p>
</footer>

</body>
</html>
